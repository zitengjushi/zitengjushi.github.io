import{j as e,p as a,ah as l,k as t,aG as i,B as s,aH as n,d as o,m as d,aj as u,ak as r,_ as m,Q as c,Y as p,ar as V,v as f,o as v,c as b,b as x,w as y,af as k,h as j,R as g,g as h}from"./index-C3ajj0iU.js";import{c as w,V as _,a as C,b as U}from"./VCard-DTBu3HW2.js";import{V as O}from"./VIcon-DO7afe9J.js";import{V as S}from"./VSpacer-DSkmVMFK.js";import{V as D}from"./VBtn-JKfmtoJ-.js";import{V as F}from"./VTextField-CT2tUTqH.js";import{V as T}from"./VDivider-BOPuQHw-.js";import{V as z,m as B,a as G}from"./VDataTable-WwBRdQ7c.js";import{V as I}from"./VDialog-BiBfv1Qk.js";import{V as A}from"./VForm-DlvED1TM.js";import{V as J}from"./VTextarea-1w5hTKuV.js";import{u as N,V as P,m as R}from"./autofocus-CGxummZr.js";import"./VAvatar-CsOZoIOv.js";import"./elevation-C2i0gTrO.js";import"./loader-_1sodkhb.js";/* empty css              */import"./VMenu-Dr7W90Y8.js";import"./index-D7kFa585.js";import"./VSlideGroup-BFt0nLex.js";const $=a({...R(),...r(B(),["inline"])},"VCheckbox"),q=e()({name:"VCheckbox",inheritAttrs:!1,props:$(),emits:{"update:modelValue":e=>!0,"update:focused":e=>!0},setup(e,a){let{attrs:r,slots:m}=a;const c=l(e,"modelValue"),{isFocused:p,focus:V,blur:f}=N(e),v=t(),b=i();return s(()=>{const[a,l]=n(r),t=P.filterProps(e),i=z.filterProps(e);return o(P,d({ref:v,class:["v-checkbox",e.class]},a,t,{modelValue:c.value,"onUpdate:modelValue":e=>c.value=e,id:e.id||"checkbox-"+b,focused:p.value,style:e.style}),{...m,default:e=>{let{id:a,messagesId:t,isDisabled:s,isReadonly:n,isValid:u}=e;return o(z,d(i,{id:a.value,"aria-describedby":t.value,disabled:s.value,readonly:n.value},l,{error:!1===u.value,modelValue:c.value,"onUpdate:modelValue":e=>c.value=e,onFocus:V,onBlur:f}),m)}})}),u({},v)}}),E={__name:"list",setup(e){const a=t(""),l=t(!1),i=[{title:"用户名",key:"username"},{title:"密码",key:"password"},{title:"Token",key:"token"},{title:"管理",key:"admin"},{title:"操作",key:"actions",sortable:!1}],s=m("axios"),n=c([]),d=c({index:-1,item:{}}),u={username:[e=>!!e||"账号不能为空"],password:[e=>!!e||"密码不能为空"]},r=t(!1);p(r,e=>{e||V(()=>{Object.assign(d,{index:-1,item:{}})})});const B=t(!1);p(B,e=>{e||V(()=>{Object.assign(d,{index:-1,item:{}})})});const N=f({get:()=>JSON.stringify(d.item.lives||[],null,2),set(e){d.item.lives=JSON.parse(e)}}),P=async()=>{l.value=!0;try{await s.delete("/user/"+d.item.username),n.splice(d.editedIndex,1),B.value=!1}finally{l.value=!1}},R=async e=>{if(!(await e).valid)return!1;l.value=!0;try{if(d.index>-1){const e=await s.put("/user",d.item);Object.assign(n[d.index],e)}else{const e=await s.post("/user",d.item);n.push(e)}r.value=!1}finally{l.value=!1}},$=async()=>{l.value=!0;try{const e=await s.get("/user/list");n.length>0&&n.splice(0,n.length),n.push(...e)}finally{l.value=!1}};return v($),(e,t)=>(x(),b(_,{flat:""},{default:y(()=>[o(w,{class:"d-flex align-center pe-2"},{default:y(()=>[o(O,{icon:"mdi-account-multiple"}),o(S),o(D,{icon:"mdi-refresh",density:"comfortable",variant:"text",class:"mr-2",onClick:$}),o(D,{icon:"mdi-account-plus",density:"comfortable",variant:"text",class:"mr-2",onClick:t[0]||(t[0]=e=>r.value=!0)}),o(F,{modelValue:j(a),"onUpdate:modelValue":t[1]||(t[1]=e=>k(a)?a.value=e:null),density:"compact",label:"Search","prepend-inner-icon":"mdi-magnify",variant:"solo-filled",flat:"","hide-details":"","single-line":""},null,8,["modelValue"])]),_:1}),o(T),o(G,{headers:i,items:j(n),loading:j(l),search:j(a),"item-key":"username","hide-default-footer":""},{"item.admin":y(({item:e})=>[o(z,{modelValue:e.admin,"onUpdate:modelValue":a=>e.admin=a,readonly:""},null,8,["modelValue","onUpdate:modelValue"])]),"item.actions":y(({item:e})=>[o(D,{icon:"mdi-pencil",density:"comfortable",class:"mr-2",size:"small",variant:"text",onClick:a=>(e=>{d.index=n.indexOf(e),d.item=Object.assign({},e),r.value=!0})(e)},null,8,["onClick"]),o(D,{icon:"mdi-delete",density:"comfortable",class:"mr-2",size:"small",variant:"text",onClick:a=>(e=>{d.index=n.indexOf(e),d.item=Object.assign({},e),B.value=!0})(e)},null,8,["onClick"])]),_:1},8,["items","loading","search"]),o(I,{modelValue:j(r),"onUpdate:modelValue":t[8]||(t[8]=e=>k(r)?r.value=e:null),"max-width":"500px"},{default:y(()=>{var e;return[o(_,{disabled:j(l),loading:j(l),"prepend-icon":"mdi-account",title:(null==(e=j(d).item)?void 0:e.username)?`修改[${j(d).item.username}]`:"添加账号"},{default:y(()=>[o(A,{"fast-fail":"",onSubmit:g(R,["prevent"])},{default:y(()=>[o(C,null,{default:y(()=>[o(F,{disabled:-1!==j(d).index,modelValue:j(d).item.username,"onUpdate:modelValue":t[2]||(t[2]=e=>j(d).item.username=e),label:"用户名",variant:"underlined",rules:u.username},null,8,["disabled","modelValue","rules"]),o(F,{modelValue:j(d).item.password,"onUpdate:modelValue":t[3]||(t[3]=e=>j(d).item.password=e),label:"密码",variant:"underlined",rules:u.password,type:"password"},null,8,["modelValue","rules"]),o(F,{modelValue:j(d).item.token,"onUpdate:modelValue":t[4]||(t[4]=e=>j(d).item.token=e),label:"Token",variant:"underlined"},null,8,["modelValue"]),o(J,{label:"直播",variant:"underlined",modelValue:j(N),"onUpdate:modelValue":t[5]||(t[5]=e=>k(N)?N.value=e:null)},null,8,["modelValue"]),o(q,{modelValue:j(d).item.admin,"onUpdate:modelValue":t[6]||(t[6]=e=>j(d).item.admin=e),label:"管理员"},null,8,["modelValue"])]),_:1}),o(T),o(U,null,{default:y(()=>[o(S),o(D,{text:"关闭",variant:"plain",onClick:t[7]||(t[7]=e=>r.value=!1)}),o(D,{type:"submit",color:"primary",text:"保存",variant:"tonal",onClick:R})]),_:1})]),_:1})]),_:1},8,["disabled","loading","title"])]}),_:1},8,["modelValue"]),o(I,{modelValue:j(B),"onUpdate:modelValue":t[10]||(t[10]=e=>k(B)?B.value=e:null),"max-width":"500px"},{default:y(()=>[o(_,{disabled:j(l),loading:j(l),"prepend-icon":"mdi-account",title:`确认删除[${j(d).item.username}]？`},{default:y(()=>[o(C,null,{default:y(()=>[...t[11]||(t[11]=[h(" 删除后不可恢复，请谨慎操作！ ",-1)])]),_:1}),o(T),o(U,null,{default:y(()=>[o(S),o(D,{text:"关闭",variant:"plain",onClick:t[9]||(t[9]=e=>B.value=!1)}),o(D,{color:"warning",text:"确认",variant:"tonal",onClick:P})]),_:1})]),_:1},8,["disabled","loading","title"])]),_:1},8,["modelValue"])]),_:1}))}};export{E as default};
